@using TaskTracker.Blazor.Domain.DTOs.Comments

<div class="comments-section">
    @if (Comments != null && Comments.Any())
    {
        @foreach (var comment in Comments.OrderByDescending(c => c.CreatedAt))
        {
            <div class="comment-item mb-3">
                <div class="d-flex gap-2">

                    <MudAvatar Size=@Size.Small
                               Color=@Color.Primary>
                        @if (!string.IsNullOrEmpty(comment.UserName))
                        {
                            @comment.UserName.Substring(0, 1).ToUpper()
                        }
                        else
                        {
                            <MudIcon Icon=@Icons.Material.Filled.Person
                                     Size=@Size.Small />
                        }
                    </MudAvatar>

                    <div style="flex: 1;">
                        <div class="d-flex justify-space-between align-center">
                            <MudText Typo=@Typo.subtitle2>
                                @(string.IsNullOrEmpty(comment.UserName) ? "Me" : comment.UserName)
                            </MudText>

                            <MudText Typo=@Typo.caption
                                     Color=@Color.Default>
                                @GetTimeAgo(comment.CreatedAt)
                            </MudText>
                        </div>

                        <MudText Typo=@Typo.body2>
                            @comment.Content
                        </MudText>
                    </div>

                </div>
            </div>
        }
    }
    else
    {
        <MudText Typo=@Typo.body2
                 Color=@Color.Default
                 Class="mb-4">
            No comments yet.
        </MudText>
    }

    <div class="mt-4">
        <MudTextField @bind-Value=@newComment
                      Label="Add a comment..."
                      Variant=@Variant.Outlined
                      Lines="3"
                      Class="mb-2" />

        <MudButton Variant=@Variant.Filled
                   Color=@Color.Primary
                   OnClick=@AddComment
                   Disabled=@string.IsNullOrWhiteSpace(newComment)>
            Post Comment
        </MudButton>
    </div>
</div>


